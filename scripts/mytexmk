#!/bin/bash

# 检查是否提供了参数
if [ $# -eq 0 ]; then
    # 没有提供参数，检查当前目录下的tex文件
    tex_files=(*.tex)
    
    # 检查是否存在tex文件
    if [ ! -f "${tex_files[0]}" ]; then
        echo "错误: 当前目录下没有找到.tex文件"
        exit 1
    fi
    
    # 检查是否只有一个tex文件
    if [ ${#tex_files[@]} -gt 1 ]; then
        echo "错误: 当前目录下存在多个.tex文件:"
        for file in "${tex_files[@]}"; do
            echo "  $file"
        done
        echo "请指定要编译的文件"
        exit 1
    fi
    
    # 使用找到的唯一tex文件
    tex_file="${tex_files[0]}"
else
    # 使用提供的参数
    tex_file="$1"
    
    # 检查文件是否存在
    if [ ! -f "$tex_file" ]; then
        echo "错误: 文件 '$tex_file' 不存在"
        exit 1
    fi
fi

echo "正在编译: $tex_file"

# 执行编译命令
echo "执行: latexmk -xelatex $tex_file"
latexmk -xelatex "$tex_file"

# 清理辅助文件
echo "执行: latexmk -c $tex_file"
latexmk -c "$tex_file"

echo "编译完成"